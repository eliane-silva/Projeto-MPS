package projetomps.view;

import lombok.AllArgsConstructor;
import projetomps.business_logic.controller.FacadeSingletonController;
import projetomps.business_logic.model.Rotation;
import projetomps.business_logic.model.Taxist;

import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeParseException;
import java.util.List;
import java.util.Scanner;
import java.util.stream.Collectors;

@AllArgsConstructor
public class TaxistView {
    private final FacadeSingletonController controller;
    private final Scanner scanner;
    private final Taxist taxist;

    public void exibirMenuPrincipal() {
        boolean continuar = true;

        limparTela();
        exibirCabecalhoTaxista();

        while (continuar) {
            try {
                exibirOpcoesTaxista();
                int opcao = lerOpcao();

                switch (opcao) {
                    case 1:
                        criarRotacao();               // <- aqui dentro h√° a op√ß√£o de usar BASE
                        break;
                    case 2:
                        listarMinhasRotacoes();
                        break;
                    case 3:
                        atualizarRotacao();
                        break;
                    case 4:
                        cancelarRotacao();
                        break;
                    case 5:
                        visualizarTodasRotacoes();
                        break;
                    case 6:
                        atualizarDadosPessoais();
                        break;
                    case 7:
                        if (controller.getRotationController().canUndo()) {
                            boolean sucesso = controller.getRotationController().undo();
                            if (sucesso) exibirSucesso("√öltima a√ß√£o desfeita!");
                            else exibirErro("Erro ao desfazer a a√ß√£o.");
                        } else {
                            System.out.println();
                            System.out.println("‚Ñπ N√£o h√° a√ß√µes para desfazer.");
                            System.out.println();
                        }
                        pausar();
                        break;
                    case 8:
                        if (controller.getRotationController().canRedo()) {
                            boolean sucesso = controller.getRotationController().redo();
                            if (sucesso) exibirSucesso("√öltima a√ß√£o refeita!");
                            else exibirErro("Erro ao refazer a a√ß√£o.");
                        } else {
                            System.out.println();
                            System.out.println("‚Ñπ N√£o h√° a√ß√µes para refazer.");
                            System.out.println();
                        }
                        pausar();
                        break;
                    case 0:
                        continuar = false;
                        exibirMensagemLogout();
                        break;
                    default:
                        exibirErro("Op√ß√£o inv√°lida! Tente novamente.");
                }
            } catch (NumberFormatException e) {
                exibirErro("Por favor, digite um n√∫mero v√°lido.");
            } catch (Exception e) {
                exibirErro("Erro inesperado: " + e.getMessage());
                pausar();
            }
        }
    }

    private void exibirCabecalhoTaxista() {
        System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        System.out.println("‚ïë                      √ÅREA DO TAXISTA                         ‚ïë");
        System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        System.out.println();
        System.out.println("üë§ Taxista: " + taxist.getName() + " (@" + taxist.getLogin() + ")");
        if (taxist.getEmail() != null && !taxist.getEmail().isEmpty()) {
            System.out.println("üìß Email: " + taxist.getEmail());
        }
        System.out.println();
    }

    private void exibirOpcoesTaxista() {
        System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
        System.out.println("‚îÇ                      MENU TAXISTA                            ‚îÇ");
        System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
        System.out.println("‚îÇ  1. Criar Nova Rota√ß√£o                                       ‚îÇ");
        System.out.println("‚îÇ  2. Minhas Rota√ß√µes                                          ‚îÇ");
        System.out.println("‚îÇ  3. Atualizar Rota√ß√£o                                        ‚îÇ");
        System.out.println("‚îÇ  4. Cancelar Rota√ß√£o                                         ‚îÇ");
        System.out.println("‚îÇ  5. Ver Todas as Rota√ß√µes do Sistema                         ‚îÇ");
        System.out.println("‚îÇ  6. Atualizar Meus Dados                                     ‚îÇ");
        System.out.println("‚îÇ  7. Desfazer √∫ltima a√ß√£o                                     ‚îÇ");
        System.out.println("‚îÇ  8. Refazer √∫ltima a√ß√£o                                      ‚îÇ");
        System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
        System.out.println("‚îÇ  0. Logout                                                   ‚îÇ");
        System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
        System.out.print("Escolha uma op√ß√£o: ");
    }

    /**
     * Criar rota√ß√£o ‚Äî com op√ß√£o embutida de USAR uma rota√ß√£o BASE (Prototype).
     * N√£o cria item extra no menu. O usu√°rio escolhe durante o fluxo.
     */
    private void criarRotacao() {
        try {
            limparTela();
            System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            System.out.println("‚ïë                     CRIAR NOVA ROTA√á√ÉO                       ‚ïë");
            System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
            System.out.println();

            // Pergunta se deseja usar uma rota√ß√£o BASE
            List<Rotation> minhasRotacoes = controller.getRotationController().getAllRotations().stream()
                    .filter(r -> r.getTaxist() != null && r.getTaxist().getId() == taxist.getId())
                    .collect(Collectors.toList());

            Rotation baseEscolhida = null;
            if (!minhasRotacoes.isEmpty()) {
                System.out.println("Deseja USAR uma rota√ß√£o BASE como modelo? (S/N)");
                String usarBase = lerEntrada();
                if ("S".equalsIgnoreCase(usarBase) || "SIM".equalsIgnoreCase(usarBase)) {
                    System.out.println();
                    System.out.println("Selecione a rota√ß√£o BASE (apenas para preencher os campos):");
                    System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
                    System.out.println("‚îÇ ID  ‚îÇ    DATA    ‚îÇ IN√çCIO  ‚îÇ   FIM   ‚îÇ  STATUS   ‚îÇ");
                    System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
                    for (Rotation r : minhasRotacoes) {
                        String endTime = (r.getEndTime() != null) ? r.getEndTime().toString() : "N/A";
                        System.out.printf("‚îÇ %-3d ‚îÇ %-10s ‚îÇ %-7s ‚îÇ %-7s ‚îÇ %-9s ‚îÇ%n",
                                r.getIdRotation(), r.getDate(), r.getStartTime(), endTime, r.getStatus());
                    }
                    System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
                    System.out.print("ID da rota√ß√£o base (0 para pular): ");
                    int idBase = lerOpcao();
                    if (idBase != 0) {
                        baseEscolhida = minhasRotacoes.stream()
                                .filter(r -> r.getIdRotation() == idBase)
                                .findFirst()
                                .orElse(null);
                        if (baseEscolhida == null) {
                            exibirErro("Rota√ß√£o base n√£o encontrada. Continuando sem base‚Ä¶");
                        }
                    }
                }
            }

            // Coleta de dados (com sugest√£o caso exista base)
            System.out.println();
            if (baseEscolhida != null) {
                System.out.println("Sugest√µes da BASE selecionada:");
                System.out.println("   Data sugerida: " + baseEscolhida.getDate());
                System.out.println("   In√≠cio sugerido: " + baseEscolhida.getStartTime());
                System.out.println("   Fim sugerido: " + (baseEscolhida.getEndTime() != null ? baseEscolhida.getEndTime() : "N/A"));
                System.out.println("   Status sugerido: " + baseEscolhida.getStatus());
                System.out.println();
                System.out.println("Deixe vazio para usar o valor SUGERIDO.");
            }

            System.out.print("Data da rota√ß√£o (AAAA-MM-DD): ");
            String dataStr = lerEntrada();

            System.out.print("Hor√°rio de in√≠cio (HH:MM): ");
            String inicioStr = lerEntrada();

            System.out.print("Hor√°rio de fim (HH:MM) - opcional: ");
            String fimStr = lerEntrada();

            try {
                // Se usar base e campos vazios, preenche com valores da base
                LocalDate data = !dataStr.isEmpty() ? LocalDate.parse(dataStr)
                        : (baseEscolhida != null ? baseEscolhida.getDate() : null);

                LocalTime horaInicio = !inicioStr.isEmpty() ? LocalTime.parse(inicioStr)
                        : (baseEscolhida != null ? baseEscolhida.getStartTime() : null);

                LocalTime horaFim = null;
                if (!fimStr.isEmpty()) {
                    horaFim = LocalTime.parse(fimStr);
                } else if (baseEscolhida != null) {
                    horaFim = baseEscolhida.getEndTime();
                }

                if (data == null || horaInicio == null) {
                    exibirErro("Data e hor√°rio de in√≠cio s√£o obrigat√≥rios!");
                    pausar();
                    return;
                }

                if (horaFim != null && horaFim.isBefore(horaInicio)) {
                    exibirErro("Hor√°rio de fim n√£o pode ser anterior ao hor√°rio de in√≠cio!");
                    pausar();
                    return;
                }

                LocalDate dataMinima = LocalDate.now().plusDays(1);
                if (data.isBefore(dataMinima)) {
                    exibirErro("N√£o √© poss√≠vel criar rota√ß√£o para hoje ou datas passadas! "
                            + "Data m√≠nima permitida: " + dataMinima);
                    pausar();
                    return;
                }

                Rotation nova;
                // Se houve BASE, cria usando o Prototype via controller; sen√£o, cria√ß√£o normal
                if (baseEscolhida != null) {
                    // Status herdado da base por padr√£o; se quiser sempre PENDING, fa√ßa p√≥s-update.
                    nova = controller.getRotationController()
                            .cloneFromPrototype(baseEscolhida, data, horaInicio, horaFim, taxist);
                } else {
                    nova = new Rotation();
                    nova.setDate(data);
                    nova.setStartTime(horaInicio);
                    nova.setEndTime(horaFim);
                    nova.setStatus("PENDING");
                    nova.setTaxist(taxist);
                    Boolean ok = controller.getRotationController().createRotation(nova);
                    if (!ok) nova = null;
                }

                if (nova != null) {
                    exibirSucesso("Rota√ß√£o criada com sucesso!");

                    // ========= PRINT DE EXEMPLO: BASE ‚Üí NOVA =========
                    if (baseEscolhida != null) {
                        System.out.println("Exemplo (usando BASE para preencher):");
                        System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
                        System.out.println("‚îÇ Campo         ‚îÇ     BASE     ‚îÇ    NOVA    ‚îÇ");
                        System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");
                        System.out.printf ("‚îÇ Data          ‚îÇ %-12s ‚îÇ %-10s ‚îÇ%n",
                                baseEscolhida.getDate(), nova.getDate());
                        System.out.printf ("‚îÇ In√≠cio        ‚îÇ %-12s ‚îÇ %-10s ‚îÇ%n",
                                baseEscolhida.getStartTime(), nova.getStartTime());
                        System.out.printf ("‚îÇ Fim           ‚îÇ %-12s ‚îÇ %-10s ‚îÇ%n",
                                (baseEscolhida.getEndTime() != null ? baseEscolhida.getEndTime() : "N/A"),
                                (nova.getEndTime() != null ? nova.getEndTime() : "N/A"));
                        System.out.printf ("‚îÇ Status        ‚îÇ %-12s ‚îÇ %-10s ‚îÇ%n",
                                baseEscolhida.getStatus(), nova.getStatus());
                        System.out.printf ("‚îÇ Taxista       ‚îÇ %-12s ‚îÇ %-10s ‚îÇ%n",
                                safeName(baseEscolhida.getTaxist()), safeName(nova.getTaxist()));
                        System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
                    } else {
                        // print padr√£o quando n√£o h√° base
                        System.out.println("üìÖ Data: " + nova.getDate());
                        System.out.println("üïê In√≠cio: " + nova.getStartTime());
                        System.out.println("üïê Fim: " + (nova.getEndTime() != null ? nova.getEndTime() : "N√£o definido"));
                        System.out.println("üìã Status: " + nova.getStatus());
                    }
                } else {
                    exibirErro("Erro ao criar rota√ß√£o. Verifique os dados informados.");
                }

            } catch (DateTimeParseException e) {
                exibirErro("Formato de data/hora inv√°lido! Use AAAA-MM-DD para data e HH:MM para hor√°rio.");
            }

        } catch (Exception e) {
            exibirErro("Erro ao criar rota√ß√£o: " + e.getMessage());
        }

        pausar();
        limparTela();
    }

    private void listarMinhasRotacoes() {
        try {
            limparTela();
            System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            System.out.println("‚ïë                      MINHAS ROTA√á√ïES                         ‚ïë");
            System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
            System.out.println();

            List<Rotation> todasRotacoes = controller.getRotationController().getAllRotations();
            List<Rotation> minhasRotacoes = todasRotacoes.stream()
                    .filter(r -> r.getTaxist() != null && r.getTaxist().getId() == taxist.getId())
                    .collect(Collectors.toList());

            if (minhasRotacoes.isEmpty()) {
                System.out.println("‚Ñπ Voc√™ ainda n√£o possui rota√ß√µes cadastradas.");
            } else {
                System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
                System.out.println("‚îÇ ID  ‚îÇ    DATA    ‚îÇ IN√çCIO  ‚îÇ   FIM   ‚îÇ  STATUS   ‚îÇ");
                System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");

                for (Rotation r : minhasRotacoes) {
                    String endTime = (r.getEndTime() != null) ? r.getEndTime().toString() : "N/A";
                    System.out.printf("‚îÇ %-3d ‚îÇ %-10s ‚îÇ %-7s ‚îÇ %-7s ‚îÇ %-9s ‚îÇ%n",
                            r.getIdRotation(),
                            r.getDate(),
                            r.getStartTime(),
                            endTime,
                            r.getStatus());
                }

                System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
                System.out.println();
                System.out.println("Total de suas rota√ß√µes: " + minhasRotacoes.size());

                long pendentes = minhasRotacoes.stream()
                        .filter(r -> "PENDING".equalsIgnoreCase(r.getStatus())).count();
                long confirmadas = minhasRotacoes.stream()
                        .filter(r -> "CONFIRMED".equalsIgnoreCase(r.getStatus())).count();
                long canceladas = minhasRotacoes.stream()
                        .filter(r -> "CANCELLED".equalsIgnoreCase(r.getStatus())).count();

                System.out.println("üìä Estat√≠sticas:");
                System.out.println("   ‚Ä¢ Pendentes: " + pendentes);
                System.out.println("   ‚Ä¢ Confirmadas: " + confirmadas);
                System.out.println("   ‚Ä¢ Canceladas: " + canceladas);
            }

        } catch (Exception e) {
            exibirErro("Erro ao listar rota√ß√µes: " + e.getMessage());
        }

        pausar();
        limparTela();
    }

    private void atualizarRotacao() {
        try {
            limparTela();
            System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            System.out.println("‚ïë                    ATUALIZAR ROTA√á√ÉO                         ‚ïë");
            System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
            System.out.println();

            List<Rotation> todasRotacoes = controller.getRotationController().getAllRotations();
            List<Rotation> minhasRotacoes = todasRotacoes.stream()
                    .filter(r -> r.getTaxist() != null && r.getTaxist().getId() == taxist.getId())
                    .collect(Collectors.toList());

            if (minhasRotacoes.isEmpty()) {
                System.out.println("‚Ñπ Voc√™ n√£o possui rota√ß√µes para atualizar.");
                pausar();
                return;
            }

            System.out.println("Suas rota√ß√µes dispon√≠veis:");
            System.out.println();
            System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
            System.out.println("‚îÇ ID  ‚îÇ    DATA    ‚îÇ IN√çCIO  ‚îÇ   FIM   ‚îÇ  STATUS   ‚îÇ");
            System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");

            for (Rotation r : minhasRotacoes) {
                String endTime = (r.getEndTime() != null) ? r.getEndTime().toString() : "N/A";
                System.out.printf("‚îÇ %-3d ‚îÇ %-10s ‚îÇ %-7s ‚îÇ %-7s ‚îÇ %-9s ‚îÇ%n",
                        r.getIdRotation(),
                        r.getDate(),
                        r.getStartTime(),
                        endTime,
                        r.getStatus());
            }

            System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
            System.out.println();

            System.out.print("Digite o ID da rota√ß√£o a ser atualizada (0 para cancelar): ");
            int id = lerOpcao();

            if (id == 0) {
                System.out.println("‚Ñπ Opera√ß√£o cancelada.");
                pausar();
                return;
            }

            Rotation rotacao = minhasRotacoes.stream()
                    .filter(r -> r.getIdRotation() == id)
                    .findFirst()
                    .orElse(null);

            if (rotacao == null) {
                exibirErro("Rota√ß√£o n√£o encontrada!");
                pausar();
                return;
            }

            System.out.println("\nDados atuais da rota√ß√£o:");
            System.out.println("Data: " + rotacao.getDate());
            System.out.println("In√≠cio: " + rotacao.getStartTime());
            System.out.println("Fim: " + (rotacao.getEndTime() != null ? rotacao.getEndTime() : "N√£o definido"));
            System.out.println("Status: " + rotacao.getStatus());

            System.out.println();
            System.out.print("Nova data (AAAA-MM-DD) - deixe vazio para manter atual: ");
            String novaDataStr = lerEntrada();

            System.out.print("Novo hor√°rio de in√≠cio (HH:MM) - deixe vazio para manter atual: ");
            String novoInicioStr = lerEntrada();

            System.out.print("Novo hor√°rio de fim (HH:MM) - deixe vazio para manter atual: ");
            String novoFimStr = lerEntrada();

            System.out.print("Novo status (PENDING/CONFIRMED/CANCELLED) - deixe vazio para manter atual: ");
            String novoStatus = lerEntrada();

            try {
                if (!novaDataStr.isEmpty()) {
                    LocalDate novaData = LocalDate.parse(novaDataStr);
                    if (novaData.isBefore(LocalDate.now())) {
                        exibirErro("N√£o √© poss√≠vel definir data passada!");
                        pausar();
                        return;
                    }
                    rotacao.setDate(novaData);
                }

                if (!novoInicioStr.isEmpty()) {
                    LocalTime novoInicio = LocalTime.parse(novoInicioStr);
                    rotacao.setStartTime(novoInicio);
                }

                if (!novoFimStr.isEmpty()) {
                    if ("null".equalsIgnoreCase(novoFimStr.trim())) {
                        rotacao.setEndTime(null);
                    } else {
                        LocalTime novoFim = LocalTime.parse(novoFimStr);
                        if (novoFim.isBefore(rotacao.getStartTime())) {
                            exibirErro("Hor√°rio de fim n√£o pode ser anterior ao hor√°rio de in√≠cio!");
                            pausar();
                            return;
                        }
                        rotacao.setEndTime(novoFim);
                    }
                }

                if (!novoStatus.isEmpty()) {
                    String statusUpper = novoStatus.toUpperCase();
                    if (statusUpper.equals("PENDING") || statusUpper.equals("CONFIRMED") ||
                        statusUpper.equals("CANCELLED")) {
                        rotacao.setStatus(statusUpper);
                    } else {
                        exibirErro("Status inv√°lido! Use PENDING, CONFIRMED ou CANCELLED.");
                        pausar();
                        return;
                    }
                }

                Rotation rotacaoAtualizada = controller.getRotationController().updateRotation(rotacao);

                if (rotacaoAtualizada != null) {
                    exibirSucesso("Rota√ß√£o atualizada com sucesso!");
                } else {
                    exibirErro("Erro ao atualizar rota√ß√£o.");
                }

            } catch (DateTimeParseException e) {
                exibirErro("Formato de data/hora inv√°lido! Use AAAA-MM-DD para data e HH:MM para hor√°rio.");
            }

        } catch (NumberFormatException e) {
            exibirErro("ID inv√°lido. Digite apenas n√∫meros.");
        } catch (Exception e) {
            exibirErro("Erro ao atualizar rota√ß√£o: " + e.getMessage());
        }

        pausar();
        limparTela();
    }

    private void cancelarRotacao() {
        try {
            limparTela();
            System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            System.out.println("‚ïë                    CANCELAR ROTA√á√ÉO                          ‚ïë");
            System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
            System.out.println();

            List<Rotation> todasRotacoes = controller.getRotationController().getAllRotations();
            List<Rotation> minhasRotacoesAtiveis = todasRotacoes.stream()
                    .filter(r -> r.getTaxist() != null && r.getTaxist().getId() == taxist.getId())
                    .filter(r -> !"CANCELLED".equalsIgnoreCase(r.getStatus()))
                    .collect(Collectors.toList());

            if (minhasRotacoesAtiveis.isEmpty()) {
                System.out.println("‚Ñπ Voc√™ n√£o possui rota√ß√µes ativas para cancelar.");
                pausar();
                return;
            }

            System.out.println("Suas rota√ß√µes que podem ser canceladas:");
            System.out.println();
            System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
            System.out.println("‚îÇ ID  ‚îÇ    DATA    ‚îÇ IN√çCIO  ‚îÇ   FIM   ‚îÇ  STATUS   ‚îÇ");
            System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");

            for (Rotation r : minhasRotacoesAtiveis) {
                String endTime = (r.getEndTime() != null) ? r.getEndTime().toString() : "N/A";
                System.out.printf("‚îÇ %-3d ‚îÇ %-10s ‚îÇ %-7s ‚îÇ %-7s ‚îÇ %-9s ‚îÇ%n",
                        r.getIdRotation(),
                        r.getDate(),
                        r.getStartTime(),
                        endTime,
                        r.getStatus());
            }

            System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
            System.out.println();

            System.out.print("Digite o ID da rota√ß√£o a ser cancelada (0 para voltar): ");
            int id = lerOpcao();

            if (id == 0) {
                System.out.println("‚Ñπ Opera√ß√£o cancelada.");
                pausar();
                return;
            }

            Rotation rotacao = minhasRotacoesAtiveis.stream()
                    .filter(r -> r.getIdRotation() == id)
                    .findFirst()
                    .orElse(null);

            if (rotacao == null) {
                exibirErro("Rota√ß√£o n√£o encontrada!");
                pausar();
                return;
            }

            System.out.println();
            System.out.println("‚ö†Ô∏è  Confirmar cancelamento da rota√ß√£o:");
            System.out.println("   Data: " + rotacao.getDate());
            System.out.println("   Hor√°rio: " + rotacao.getStartTime() +
                    " - " + (rotacao.getEndTime() != null ? rotacao.getEndTime() : "Indefinido"));
            System.out.println("   Status atual: " + rotacao.getStatus());
            System.out.println();
            System.out.print("Confirma o cancelamento? (S/N): ");

            String confirmacao = lerEntrada();

            if ("S".equalsIgnoreCase(confirmacao) || "SIM".equalsIgnoreCase(confirmacao)) {
                rotacao.setStatus("CANCELLED");
                Rotation rotacaoAtualizada = controller.getRotationController().updateRotation(rotacao);

                if (rotacaoAtualizada != null) {
                    exibirSucesso("Rota√ß√£o cancelada com sucesso!");
                } else {
                    exibirErro("Erro ao cancelar rota√ß√£o.");
                }
            } else {
                System.out.println("‚Ñπ Cancelamento n√£o confirmado.");
            }

        } catch (NumberFormatException e) {
            exibirErro("ID inv√°lido. Digite apenas n√∫meros.");
        } catch (Exception e) {
            exibirErro("Erro ao cancelar rota√ß√£o: " + e.getMessage());
        }

        pausar();
        limparTela();
    }

    private void visualizarTodasRotacoes() {
        try {
            limparTela();
            System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            System.out.println("‚ïë                 TODAS AS ROTA√á√ïES DO SISTEMA                 ‚ïë");
            System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
            System.out.println();

            List<Rotation> rotacoes = controller.getRotationController().getAllRotations();

            if (rotacoes.isEmpty()) {
                System.out.println("‚Ñπ Nenhuma rota√ß√£o cadastrada no sistema.");
            } else {
                System.out.println("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê");
                System.out.println("‚îÇ ID  ‚îÇ    DATA    ‚îÇ IN√çCIO  ‚îÇ   FIM   ‚îÇ  STATUS   ‚îÇ     TAXISTA     ‚îÇ");
                System.out.println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§");

                for (Rotation r : rotacoes) {
                    String taxistaInfo = "N/A";
                    if (r.getTaxist() != null) {
                        if (r.getTaxist().getId() == taxist.getId()) taxistaInfo = ">>> VOC√ä <<<";
                        else taxistaInfo = r.getTaxist().getName();
                    }

                    String endTime = (r.getEndTime() != null) ? r.getEndTime().toString() : "N/A";

                    System.out.printf("‚îÇ %-3d ‚îÇ %-10s ‚îÇ %-7s ‚îÇ %-7s ‚îÇ %-9s ‚îÇ %-15s ‚îÇ%n",
                            r.getIdRotation(),
                            r.getDate(),
                            r.getStartTime(),
                            endTime,
                            r.getStatus(),
                            taxistaInfo);
                }

                System.out.println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò");
                System.out.println();
                System.out.println("Total de rota√ß√µes no sistema: " + rotacoes.size());

                long minhasRotacoes = rotacoes.stream()
                        .filter(r -> r.getTaxist() != null && r.getTaxist().getId() == taxist.getId())
                        .count();
                long outrasRotacoes = rotacoes.size() - minhasRotacoes;

                System.out.println("üìä Resumo:");
                System.out.println("   ‚Ä¢ Suas rota√ß√µes: " + minhasRotacoes);
                System.out.println("   ‚Ä¢ Rota√ß√µes de outros taxistas: " + outrasRotacoes);
            }

        } catch (Exception e) {
            exibirErro("Erro ao visualizar rota√ß√µes: " + e.getMessage());
        }

        pausar();
        limparTela();
    }

    private void atualizarDadosPessoais() {
        try {
            limparTela();
            System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
            System.out.println("‚ïë                   ATUALIZAR MEUS DADOS                       ‚ïë");
            System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
            System.out.println();

            System.out.println("Dados atuais:");
            System.out.println("Login: " + taxist.getLogin());
            System.out.println("Nome: " + (taxist.getName() != null ? taxist.getName() : "N√£o informado"));
            System.out.println("Email: " + (taxist.getEmail() != null ? taxist.getEmail() : "N√£o informado"));
            System.out.println();

            System.out.print("Novo nome (deixe vazio para manter atual): ");
            String novoNome = lerEntrada();

            System.out.print("Novo email (deixe vazio para manter atual): ");
            String novoEmail = lerEntrada();

            System.out.print("Nova senha (deixe vazio para manter atual): ");
            String novaSenha = lerEntrada();

            boolean alterado = false;

            if (!novoNome.isEmpty()) { taxist.setName(novoNome); alterado = true; }
            if (!novoEmail.isEmpty()) { taxist.setEmail(novoEmail); alterado = true; }
            if (!novaSenha.isEmpty()) { taxist.setSenha(novaSenha); alterado = true; }

            if (!alterado) {
                System.out.println("‚Ñπ Nenhuma altera√ß√£o foi feita.");
            } else {
                var taxistaAtualizado = controller.getUserController().atualizarTaxista(taxist);
                if (taxistaAtualizado.isPresent()) {
                    exibirSucesso("Dados atualizados com sucesso!");
                    taxist.setName(taxistaAtualizado.get().getName());
                    taxist.setEmail(taxistaAtualizado.get().getEmail());
                    taxist.setSenha(taxistaAtualizado.get().getSenha());
                } else {
                    exibirErro("Erro ao atualizar dados. Verifique as informa√ß√µes fornecidas.");
                }
            }

        } catch (Exception e) {
            exibirErro("Erro ao atualizar dados: " + e.getMessage());
        }

        pausar();
        limparTela();
    }

    // ===== utils =====

    private String safeName(Taxist t) {
        return (t != null && t.getName() != null) ? t.getName() : "N/A";
    }

    private void exibirMensagemLogout() {
        limparTela();
        System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        System.out.println("‚ïë                                                              ‚ïë");
        System.out.println("‚ïë                    LOGOUT REALIZADO                         ‚ïë");
        System.out.println("‚ïë                                                              ‚ïë");
        System.out.println("‚ïë            Obrigado por usar o sistema, Taxista!            ‚ïë");
        System.out.println("‚ïë                                                              ‚ïë");
        System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        System.out.println();
        System.out.print("Pressione ENTER para continuar...");
        scanner.nextLine();
    }

    private int lerOpcao() {
        try {
            return Integer.parseInt(scanner.nextLine().trim());
        } catch (NumberFormatException e) {
            return -1;
        }
    }

    private String lerEntrada() {
        String entrada = scanner.nextLine();
        return entrada != null ? entrada.trim() : "";
    }

    private void exibirSucesso(String mensagem) {
        System.out.println();
        System.out.println("‚úì " + mensagem);
        System.out.println();
    }

    private void exibirErro(String mensagem) {
        System.out.println();
        System.out.println("‚úó " + mensagem);
        System.out.println();
    }

    private void pausar() {
        System.out.print("Pressione ENTER para continuar...");
        scanner.nextLine();
    }

    private void limparTela() {
        for (int i = 0; i < 50; i++) System.out.println();
    }
}
